# Online School Management System Requirements Document

## 1. Application Description

### 1.1 Application Name
Online School Management System\n
### 1.2 Application Purpose
A comprehensive school management system for educational institutions. Features include school management, academic structure setup (class, section, subject, lesson), teacher-subject-class-section mapping, question bank management with lesson-level tracking, question paper preparation with shuffle functionality, user management with school-based data isolation.\n
## 2. User Roles\n
### 2.1 Admin
- Complete system administration
- School management (create, edit, view schools)\n- User account creation and management
- New user approval management
- Role-based Access Control setup
- System configurations\n- Permission management
- User profile editing and suspension management
- **Cross-school visibility**: Admin can view and manage all schools and users across the entire system
- **Full management rights**: Create, edit, suspend, delete all users and schools

### 2.2 Principal
- **Academic Management** (within assigned school only):
  - Class creation\n  - Section creation
  - Subject creation (class-wise)
  - Lesson creation (subject-wise)
  - Student class-section mapping
- **Teacher Management** (within assigned school only):
  - View teacher accounts
  - Teacher-subject-class-section mapping\n  - View class-section overview with assigned teachers per subject
  - Edit teacher profiles
- **Student Management** (within assigned school only):
  - View students list
  - View student class-section assignments
- **Question Bank Management** (within assigned school only):
  - Create and manage questions with lesson-level tracking
  - Insert images/clip arts in questions
  - View question bank analytics
  - Switch between Row View and Card View
  - Edit questions in both views
- Profile editing capability
- Linked to specific school from school master list
- **School-based isolation**: Can only view and manage users (teachers and students) from their assigned school
- **Visibility Rules**:
  - ✅ Can view: Teachers from their own school, Students from their own school
  - ❌ Cannot view: Users from other schools
\n### 2.3 Teacher
- View assigned classes, sections, and subjects
- View students of assigned sections only
- **Question Bank Access**:
  - Create questions for assigned subjects and lessons
  - Insert images/clip arts in questions
  - View questions filtered by assigned subjects
  - Switch between Row View and Card View
  - Edit own questions in both views
- **Question Paper Preparation**:
  - Create question papers from own question bank
  - Select questions by class and subject
  - Shuffle questions and MCQ options
  - Preview, save as draft, generate final paper
  - Export as PDF and print
  - **Save shuffled papers with custom names**
- Profile editing capability
- Linked to specific school from school master list
- **School-based isolation**: Can only view and interact with students from their assigned sections
- **Visibility Rules**:
  - ✅ Can view: Students from their assigned sections
  - ❌ Cannot view: Principal (even from the same school), Other teachers (even from the same school), Users from other schools

### 2.4 Student
- View my class, section, subjects, and teachers
- Profile editing capability
- Linked to specific school from school master list
- **School-based isolation**: Can only view personal information from their assigned school
- **Visibility Rules**:
  - ✅ Can view: Only their own profile details, Personal information, and assigned content
  - ❌ Cannot view: Other students, Teachers, Principal, Admin\n
### 2.5 User Profile Information
All users (Admin, Principal, Teacher, Student) will have the following profile information:
- User name
- Email address
- Role\n- School name (mandatory field, selected from dropdown list populated from School Master)
- Contact number
- Profile picture (optional)\n- Account status (Pending Approval/Active/Suspended)
\n## 3. School Management Module

### 3.1 School Master
Admin can create and manage schools with the following details:
\n#### 3.1.1 School Information Fields
- School Name (unique, mandatory)
- Assignment (optional, selected from existing School Name)\n- School Address (mandatory)
- Contact Number (mandatory)
- Email Address (mandatory)
- School Code/ID (unique identifier, auto-generated by system)
- Affiliation/Board (mandatory, e.g., State Board, CBSE, ICSE, etc.)
- Class Range (mandatory):\n  - Class From (e.g., 1, 6, 9)
  - Class To (e.g., 5, 10, 12)
- Subjects (mandatory, list of subjects offered by the school)
- Principal Name (mandatory, selected from existing user list with Principal role)
\n#### 3.1.2 School Management Features
- Create new school with all mandatory fields
- Edit existing school information
- View complete school list\n- Search and filter schools by name, code, or affiliation
- Auto-generate unique School Code/ID upon school creation
- Link Principal from existing user database (dropdown selection)
- Define subject list for each school
- Assign school to another school via Assignment field (optional)
\n#### 3.1.3 School-User Relationship
- When creating/editing user accounts, Admin selects school from dropdown (populated from School Master)
- Principal, Teacher, and Student roles must be linked to a school
- Admin role is not linked to any specific school
- One Principal can be assigned to only one school
- Multiple Teachers and Students can be assigned to same school

## 4. School-Based Data Isolation

### 4.1 Isolation Principle
- Users from same school form an isolated group
- Within each school group, Principal, Teachers, and Students can only see and interact with users based on their role-specific visibility rules
- Admin has cross-school visibility and can manage all schools\n
### 4.2 Isolation Implementation
\n#### 4.2.1 User Visibility Rules
- **Admin**: Can view all users from all schools
- **Principal**: Can only view teachers and students from assigned school
- **Teacher**: Can only view students from assigned sections (cannot view Principal or other teachers)
- **Student**: Can only view their own profile and personal information (cannot view other students, teachers, or Principal)

#### 4.2.2 Search and Filter
- All user lists are automatically filtered by school and role-based visibility rules
- Search functionality respects school-based isolation and role permissions
- Dropdown lists and selection options show only school-relevant and role-appropriate data

### 4.3 School Group Interconnection
- All users within same school are interconnected based on role-specific visibility\n- Principal oversees all teachers and students in their school
- Teachers can view student lists within their assigned sections (but not Principal or other teachers)
- Students can only access their own information\n- Communication and notifications are school-scoped and role-appropriate

## 5. Principal Dashboard - Academic Management Module

### 5.1 Principal Dashboard Overview
After Principal login, the dashboard displays four main cards:
- **Academic Management**: Manage academic structure (classes, sections, subjects, lessons, student mapping)
- **Teachers**: Manage teacher accounts and teacher-subject-class-section mapping\n- **Students**: View and manage students\n- **Question Bank**: Manage exam questions with lesson-level tracking and dual view options
\n**UI Language Requirement**: All card titles, labels, and UI text on Principal Dashboard must be displayed in English only. Card titles should be 'Academic Management', 'Teachers', 'Students', and 'Question Bank' (not in Tamil or any other language).

### 5.2 Academic Card - Academic Structure Management

#### 5.2.1 Class Creation
- Principal can create classes for their assigned school
- Class information fields:\n  - Class Name (e.g., Class 6, Class 7, Class 8, etc.)
  - Class Code (auto-generated or manual entry)
  - Academic Year (e.g., 2024-2025)\n- Class list view with edit and delete options
- Classes are school-specific and isolated\n
#### 5.2.2 Section Creation
- Principal can create sections for each class
- Section information fields:\n  - Section Name (e.g., Section A, Section B, Section C)
  - Class (dropdown selection from created classes)
  - Maximum Students (optional)
- Section list view with class-wise filtering
- Sections are linked to specific classes within the school

#### 5.2.3 Subject Creation (Class-wise)
- Principal can create subjects for each class
- Subject information fields:
  - Subject Name (e.g., Mathematics, Science, English)\n  - Class (dropdown selection from created classes)
  - Subject Code (auto-generated or manual entry)
  - Subject Type (Core/Elective/Optional)
- Subject list view with class-wise filtering
- Subjects are class-specific and school-specific

#### 5.2.4 Lesson Creation (Subject-wise)
- Principal can create lessons for each subject
- Lesson information fields:
  - Lesson Name (mandatory, e.g., 'Algebra Basics', 'Photosynthesis', 'Shakespeare Introduction')
  - Subject (dropdown selection from created subjects)
  - Lesson Code (optional, e.g., 'MATH-L01', 'SCI-L05')
- Lesson list view with subject-wise filtering
- Lessons are subject-specific and school-specific
- **Database Structure**:
  - Table name: lessons
  - Columns:\n    - id (UUID, Primary Key)
    - subject_id (Foreign Key → subjects.id)
    - lesson_name (Text, required)
    - lesson_code (Varchar, optional)
    - created_at (Timestamp)\n    - updated_at (Timestamp)
\n#### 5.2.5 Student Class-Section Mapping
- Principal can assign students to specific class and section
- **Note**: Student accounts are already created via Sign-Up process, only class-section assignment is done here
- Mapping interface:
  - Student selection (dropdown or search from existing students in the school)
  - Class selection (dropdown)\n  - Section selection (dropdown, filtered by selected class)
  - Academic Year\n- Bulk assignment option for multiple students
- View current class-section assignments with edit and reassign options
- Students without class-section assignment are listed separately for easy identification

### 5.3 Teachers Card - Teacher Management

#### 5.3.1 Teacher Accounts
- **Note**: Teacher accounts are already created via Sign-Up process and mapped to school by Admin
- Principal can view all teachers in their assigned school
- Teacher list displays:
  - Teacher Name
  - Subject specialization
  - Phone Number
  - Account Status (Active/Pending/Suspended)
  - **Edit Action**: Edit button or pencil icon for each teacher row to enable profile editing
- **Enhanced Search and Filter Functionality**:
  - Text search bar for searching by teacher name, phone number, or email
  - Additional dropdown filters:\n    - Subject filter (dropdown showing all subjects in the school)
    - Status filter (dropdown with options: All, Active, Pending, Suspended)
- Combined search capability (text search + subject filter + status filter)
  - Real-time filtering as user types or selects filter options
  - Clear filters button to reset all search and filter criteria

#### 5.3.2 Teacher-Subject-Class-Section Mapping (Heart of the System)
- Principal assigns teachers to specific subjects, classes, and sections
- Mapping interface:
  - Teacher selection (dropdown from school teachers)
  - Subject selection (dropdown from school subjects)
  - Class selection (dropdown from school classes)
  - Section selection (multi-select, filtered by selected class)
- One teacher can be assigned to multiple subject-class-section combinations
- View current teacher assignments with edit and delete options
- **This mapping is the core of the system**: It determines which students a teacher can view\n
#### 5.3.3 Class-Section Overview
- Principal can view class-section overview showing:
  - Class and Section name
  - Assigned Teachers per Subject
  - Students List in that section
- Detailed view with subject-wise teacher assignments
- Student count per section
- Quick access to edit teacher assignments or student mappings

### 5.4 Students Card - Student Management
- Principal can view all students in their assigned school
- Student list displays:
  - Student Name
  - Class and Section
  - Phone Number
  - Account Status (Active/Pending/Suspended)
- **Enhanced Search Functionality**: \n  - Text search bar for searching by name, phone, or email
  - Additional dropdown filters for Class and Section
  - Combined search capability (text search + class filter + section filter)
- Filter and search options by class, section, or name
- Click on student to view detailed profile and academic records
\n### 5.5 Question Bank Card - Question Management
- Principal can access Question Bank management interface
- Create, edit, and delete questions for exam preparation
- **Insert images/clip arts in questions**
- **Dual View Options**:
  - Row View (table format)
  - Card View (detailed card format)
- View all questions with lesson-level filtering
- Analytics dashboard for question bank performance
\n## 6. Question Bank Module

### 6.1 Question Bank Overview
- Centralized repository for exam questions
- Questions are organized by Class, Subject, and Lesson
- Support for multiple question types (Multiple Choice, True/False, Short Answer, Essay, Match the Following, Multiple Response MCQ)
- Difficulty levels (Easy, Medium, Hard)\n- Marks allocation per question
- **Minus Mark (Negative Marking) support**: Questions can have negative marks for incorrect answers
- Lesson-level tracking for performance analytics
- **Image/Clip Art support**: Questions can include images or clip arts
- **Dual view display options**: Row View and Card View

### 6.2 Question Bank Table Structure
\n#### 6.2.1 Database Schema
**Table name**: question_bank

**Columns**:
- id (UUID, Primary Key)
- school_id (Foreign Key → schools.id)
- class_id (Foreign Key → classes.id)
- subject_id (Foreign Key → subjects.id)
- lesson_id (Foreign Key → lessons.id)
- bank_name (Varchar, auto-generated)
  - Format: Class_Subject (e.g., 'Class10_English', 'Class6_Mathematics')
  - Auto-generated by combining selected Class name and Subject name
- question_text (Text, required)
- question_type (Enum: Multiple Choice, True/False, Short Answer, Essay, Match the Following, Multiple Response MCQ)
- marks (Integer, required)
- **minus_mark (Decimal, optional)**
  - Stores negative marks for incorrect answers
  - Format: Decimal value (e.g., 0.25, 0.5, 1.0)
  - Default value: 0 (no negative marking)
  - Can be null or zero if no negative marking is applied
- difficulty (Enum: Easy, Medium, Hard)
- options (JSON array, required for Multiple Choice, True/False, Match the Following, and Multiple Response MCQ)
- correct_answer (Text or JSON array, required)\n  - For Multiple Choice and True/False: Text (single correct answer)
  - For Short Answer and Essay: Text\n  - For Match the Following: JSON array storing correct pairs
  - For Multiple Response MCQ: JSON array storing multiple correct answers
- **question_images (JSON array, optional)**
  - Stores array of image URLs or file paths
  - Format: [{url: 'path/to/image1.jpg', caption: 'Image description'}, {url: 'path/to/image2.png', caption: 'Diagram'}]
  - Supports multiple images per question
- created_by (Foreign Key → users.id)
- created_at (Timestamp)
- updated_at (Timestamp)\n\n#### 6.2.2 Foreign Key Relationships
- school_id → schools.id (CASCADE on delete)
- class_id → classes.id (CASCADE on delete)
- subject_id → subjects.id (CASCADE on delete)
- lesson_id → lessons.id (CASCADE on delete)
- created_by → users.id (SET NULL on delete)
\n### 6.3 Question Creation Form

#### 6.3.1 Form Field Order
The question creation form displays fields in the following order:
1. **Class** (Dropdown, required)
   - Populated from classes table filtered by school_id
   - Selection triggers Subject dropdown population
2. **Subject** (Dropdown, required)
   - Populated from subjects table filtered by selected class_id
   - Selection triggers Lesson dropdown population
3. **Lesson** (Dropdown, required)
   - Populated from lessons table filtered by selected subject_id
   - Displays lesson_name with optional lesson_code
4. **Question** (Text area, required)
   - Enter question text
5. **Insert Images/Clip Arts** (Image upload field, optional)
   - **Upload Button**: 'Add Image' or 'Insert Image' button with image icon
   - **File Selection Methods**:
     - **Method 1: Click to Browse**: Click button to open native file browser dialog for selecting files from local drive
     - **Method 2: Drag and Drop**: Drag image files from local file explorer and drop into designated upload area
     - **Method 3: URL Input**: Optional text input field to enter image URL (e.g., https://example.com/image.jpg)
   - **Local File Browser Features**:
     - Opens system native file picker dialog
     - Allows navigation through local folders and drives (C:, D:, external drives, network drives)
     - Supports multi-file selection (Ctrl+Click or Shift+Click to select multiple images at once)
     - File type filter pre-applied to show only supported image formats
     - Preview thumbnails in file browser (if supported by OS)
   - **Supported Formats**: JPG, JPEG, PNG, GIF, SVG (max file size: 5MB per image)
   - **Multiple Images**: Users can upload multiple images for a single question
   - **Image Preview**: Thumbnail preview of uploaded images displayed below upload button
   - **Image Management**:
     - Each uploaded image shows thumbnail with caption input field
     - Delete button (X icon) on each image thumbnail to remove image
     - Drag-and-drop reordering of images (optional)
   - **Image Caption**: Optional text field below each image for description
   - **Storage**: Images uploaded to server storage, URLs stored in question_images JSON array
   - **Upload Progress Indicator**: Progress bar showing upload status for each file
   - **Error Handling**: Display clear error messages for:\n     - Unsupported file formats
     - Files exceeding size limit
     - Network upload failures
     - Duplicate file names
6. **Question Type** (Dropdown, required)\n   - Options: Multiple Choice, True/False, Short Answer, Essay, Match the Following, Multiple Response MCQ
   - Selection determines whether Options field is displayed
7. **Marks** (Number input, required)
   - Integer value (e.g., 1, 2, 5, 10)
8. **Minus Mark** (Number input, optional)
   - **Label**: 'Minus Mark (Negative Marking)'
   - **Field Type**: Decimal number input
   - **Placeholder**: 'Enter negative marks (e.g., 0.25, 0.5, 1.0)'
   - **Validation**: \n     - Accepts decimal values (e.g., 0.25, 0.5, 1.0)
     - Must be zero or positive value (stored as negative in calculations)
     - Cannot exceed the Marks value
     - Optional field (can be left empty or set to 0 for no negative marking)
   - **Default Value**: 0 (no negative marking)
   - **Help Text**: 'Marks to be deducted for incorrect answer. Leave empty or enter 0 for no negative marking.'
   - **Position**: Displayed immediately after Marks field
9. **Difficulty** (Dropdown, required)\n   - Options: Easy, Medium, Hard
10. **Options** (Dynamic fields, conditional)\n   - For Multiple Choice: Four option input fields (Option1, Option 2, Option 3, Option 4) displayed simultaneously
   - For True/False: Two option input fields (True, False) displayed simultaneously
   - For Match the Following: Two columns of input fields\n     - Left Column: Items to be matched (e.g., Item1, Item 2, Item 3, Item 4)
     - Right Column: Matching options (e.g., Option A, Option B, Option C, Option D)
     - All pairs displayed simultaneously (no'Add Pair' button)
   - For Multiple Response MCQ: Four option input fields (Option 1, Option 2, Option 3, Option 4) displayed simultaneously with checkboxes to mark multiple correct answers
   - For Short Answer and Essay: Options field is hidden\n11. **Correct Answer** (Text input, dropdown, or multi-select, required)
   - For Multiple Choice: Dropdown selection from entered options (single selection)
   - For True/False: Dropdown with True/False options (single selection)
   - For Short Answer/Essay: Text input field
   - For Match the Following: Auto-generated based on user's pairing in Options field (stored as JSON array of correct pairs)
   - For Multiple Response MCQ: Multi-select checkboxes from entered options (multiple selections allowed, stored as JSON array)\n\n#### 6.3.2 Form Behavior
- **Cascading Dropdowns**: Class → Subject → Lesson\n- **Auto-generation**: bank_name field is auto-generated upon form submission by combining selected Class name and Subject name (e.g., 'Class10_English')
- **Validation**: All required fields must be filled before submission
- **Minus Mark Validation**:
  - Check if minus_mark value is zero or positive
  - Check if minus_mark does not exceed marks value
  - Display error message if validation fails
  - Allow empty value (treated as 0)\n- **Image Upload Validation**: \n  - Check file format (JPG, JPEG, PNG, GIF, SVG only)
  - Check file size (max 5MB per image)
  - Display error message for invalid files
  - Validate file accessibility from local drive
- **Form Persistence Issue Fix**: After submitting a question, the form should clear all fields except Class and Subject, which should remain populated to allow immediate entry of a new question for the same Class and Subject\n- **Options Display**: \n  - For Multiple Choice and Multiple Response MCQ: All four option fields (Option 1, Option 2, Option 3, Option 4) are displayed simultaneously
  - For True/False: Two option fields (True, False) are displayed simultaneously\n  - For Match the Following: All pairing fields (Left Column and Right Column) are displayed simultaneously
\n#### 6.3.3 Form Actions
- **Add Button**: Saves the question to question_bank table (including uploaded images and minus_mark value)
- **Cancel Button**: Clears the form and closes the dialog
- **Validation Messages**: Display error messages for missing required fields or invalid inputs
\n#### 6.3.4 Question Type Specific Details
\n#####6.3.4.1 Match the Following
- **Purpose**: Test students' ability to match related items from two columns
- **Options Field Structure**:
  - Left Column (Items): Input fields for items to be matched (e.g., 'Alpha decay', 'Beta decay', 'Gamma decay', 'Neutron decay')
  - Right Column (Matching Options): Input fields for matching options (e.g., 'Changes atomic number', 'No change in atomic number', 'Emits helium nucleus', 'Emits electron')
  - Minimum 3 pairs, maximum 6 pairs
- **Correct Answer Storage**: JSON array storing correct pairs (e.g., [{left: 'Alpha decay', right: 'Emits helium nucleus'}, {left: 'Gamma decay', right: 'No change in atomic number'}])
- **Display in Card View**: Show left column items with corresponding right column matches, with correct pairs highlighted
- **Display in Row View**: Show truncated question text with 'Match the Following' badge

##### 6.3.4.2 Multiple Response MCQ
- **Purpose**: Test students' ability to identify multiple correct answers from given options
- **Example Question**: 'In which of the following decay processes does the atomic number of the nucleus remain unchanged? (i) Alpha decay (ii) Beta decay (iii) Gamma decay (iv) Neutron decay'
- **Options Field Structure**:
  - Four option input fields (Option 1, Option 2, Option 3, Option 4) displayed simultaneously
  - Each option has a checkbox to mark as correct answer
  - Multiple checkboxes can be selected\n- **Correct Answer Storage**: JSON array storing multiple correct answers (e.g., ['(ii) Beta decay', '(iii) Gamma decay'])
- **Display in Card View**: Show all options with multiple correct answers highlighted with checkmark icons and green background
- **Display in Row View**: Show truncated question text with 'Multiple Response MCQ' badge\n- **Validation**: At least two options must be marked as correct for Multiple Response MCQ type

### 6.4 Question Bank Dual View Display

#### 6.4.1 View Toggle Control
- **View Switcher**: Toggle button or tab control at the top of Question Bank page
  - Row View icon/button (table/list icon)
  - Card View icon/button (grid/card icon)
- User can switch between views with single click
- Selected view preference is saved in user session
- Default view: Row View\n
#### 6.4.2 Row View (Table Format)
\n**Display Columns**:
- Question (truncated text with expand option)
- **Image Indicator** (icon showing if question has images)
- Class\n- Subject
- Lesson
- Question Type
- Difficulty
- Marks
- **Minus Mark** (displays negative marking value, shows '0' or '-' if no negative marking)
- Actions (Edit, Delete)

**Features**:
- Compact table layout showing multiple questions per screen
- Sortable columns\n- Hover effect on rows
- Click on question text to expand full question with images
- **Image Indicator**: Small image icon displayed in Question column if question contains images
- **Minus Mark Display**: Shows the negative marking value in a separate column, formatted as decimal (e.g., '0.25', '0.5', '1.0'), displays '0' or '-' if no negative marking
- Edit icon/button in Actions column\n- Delete icon/button in Actions column\n- **Question Type Badges**: Color-coded badges for each question type\n  - Multiple Choice - Blue
  - True/False - Green
  - Short Answer - Orange
  - Essay - Purple\n  - Match the Following - Teal
  - Multiple Response MCQ - Indigo
\n#### 6.4.3 Card View (Detailed Card Format)

**Card Layout**:
Each question displayed as a card with the following sections:
\n**Card Header**:
- Question Type badge (color-coded: Multiple Choice - Blue, True/False - Green, Short Answer - Orange, Essay - Purple, Match the Following - Teal, Multiple Response MCQ - Indigo)
- Difficulty badge (color-coded: Easy - Green, Medium - Yellow, Hard - Red)
- Marks display (e.g., '5Marks')
- **Minus Mark display** (e.g., '-0.25' or 'No Negative Marking' if zero)\n\n**Card Body**:
- **Question Text**: Full question displayed prominently
- **Question Images** (if present):
  - Display all uploaded images in a gallery format
  - Image thumbnails with captions below each image
  - Click on image to view full-size in lightbox/modal
  - Multiple images displayed in horizontal scrollable row or grid layout
- **Class**: Class name with icon
- **Subject**: Subject name with icon
- **Lesson**: Lesson name with icon
- **Marks**: Positive marks for correct answer\n- **Minus Mark**: Negative marks for incorrect answer (displayed as 'Minus Mark:0.25' or 'No Negative Marking' if zero)
- **Options** (for Multiple Choice, True/False, Match the Following, and Multiple Response MCQ):
  - For Multiple Choice and True/False: All options listed with option labels (A, B, C, D), correct answer highlighted with checkmark icon and green background
  - For Match the Following: Two-column layout showing left items and right matches, with correct pairs connected by visual lines or highlighted\n  - For Multiple Response MCQ: All options listed with option labels (A, B, C, D), multiple correct answers highlighted with checkmark icons and green background
- **Correct Answer** (for Short Answer and Essay):
  - Displayed in separate section with label\n\n**Card Footer**:
- **Edit Button**: Prominent edit button with icon
- **Delete Button**: Delete button with icon
- **Created By**: Display creator name (optional)
- **Created Date**: Display creation date (optional)
\n**Card Design Specifications**:
- Card width: Responsive (3cards per row on desktop, 2 on tablet, 1 on mobile)
- Card padding: 20px
- Card border: 1px solid light gray with8px border radius
- Card shadow: Subtle shadow on hover
- Card spacing: 16px gap between cards
- Typography:\n  - Question text: 16px, bold\n  - Metadata (class, subject, lesson, marks, minus mark): 14px, regular
  - Options: 14px, regular
  - Badges: 12px, bold
- **Image Display**:
  - Image thumbnails: 150px width, auto height, maintain aspect ratio
  - Image captions: 12px, italic, gray color
  - Image gallery: Horizontal scroll or grid layout with8px gap between images
- **Minus Mark Display**:
  - Label: 'Minus Mark:' followed by value\n  - Color: Red or orange to indicate negative marking
  - Font size: 14px, regular
  - Display'No Negative Marking' in gray if value is 0
\n#### 6.4.4 Edit Functionality in Both Views

**Row View Edit**:
- Edit icon/button in Actions column
- Click opens edit dialog/modal with pre-filled form
- Form fields same as creation form (including image upload section with local file selection and minus_mark field)
- **Image Editing**:
  - Display existing images with thumbnails and captions
  - Delete button on each existing image
  - Add new images button (with local file browser and drag-drop support)
  - Update image captions\n- **Minus Mark Editing**:\n  - Pre-populate minus_mark field with existing value
  - Allow modification of minus_mark value
  - Validate new minus_mark value\n- Save button updates question\n- Cancel button closes dialog without changes

**Card View Edit**:
- Edit button in card footer
- Click opens edit dialog/modal with pre-filled form\n- Form fields same as creation form (including image upload section with local file selection and minus_mark field)
- **Image Editing**:
  - Display existing images with thumbnails and captions
  - Delete button on each existing image
  - Add new images button (with local file browser and drag-drop support)\n  - Update image captions\n- **Minus Mark Editing**:
  - Pre-populate minus_mark field with existing value\n  - Allow modification of minus_mark value
  - Validate new minus_mark value
- Save button updates question and refreshes card display
- Cancel button closes dialog without changes

**Edit Form Behavior**:
- All fields pre-populated with existing question data
- Cascading dropdowns maintain relationships (Class → Subject → Lesson)
- Options displayed for Multiple Choice, True/False, Match the Following, and Multiple Response MCQ types
- **Existing images displayed with edit/delete options**
- **Minus Mark field pre-populated with existing value**
- For Match the Following: Pre-populate left and right column pairs\n- For Multiple Response MCQ: Pre-populate options and mark correct answers with checkboxes
- Validation applied on save
- Success message displayed after successful update
- Error message displayed if update fails

#### 6.4.5 Filter and Search Options (Both Views)
- Text search by question text
- Filter by Class (dropdown)
- Filter by Subject (dropdown, filtered by selected Class)
- Filter by Lesson (dropdown, filtered by selected Subject)\n- Filter by Question Type (dropdown, including Match the Following and Multiple Response MCQ)
- Filter by Difficulty (dropdown)\n- **Filter by Has Images** (checkbox: Show only questions with images)
- **Filter by Has Negative Marking** (checkbox: Show only questions with minus_mark > 0)
- Combined filtering capability
- Clear filters button
- Filter results update in real-time for both Row View and Card View

#### 6.4.6 Sorting Options (Both Views)
- Sort by Class\n- Sort by Subject
- Sort by Lesson
- Sort by Difficulty
- Sort by Marks\n- **Sort by Minus Mark** (ascending/descending)
- Sort by Created Date
- Ascending/Descending toggle
\n### 6.5 Question Bank Analytics (Future Scope)

#### 6.5.1 Lesson-Level Performance Analysis
- **Purpose**: Enable performance analysis at lesson level for students
- **Data Storage**: lesson_id is stored with each question to enable future analytics
- **Future Reports**:
  - Lesson-wise accuracy of students (e.g., 'Students scored 75% on Lesson: Algebra Basics')
  - Lesson-wise difficulty analysis (e.g., 'Lesson: Photosynthesis has 60% Hard questions')
  - Lesson-wise question distribution (e.g., 'Lesson: Shakespeare Introduction has 10Multiple Choice, 5 Short Answer, 3 Match the Following, 2 Multiple Response MCQ questions')
  - Student performance comparison across lessons
  - Class-wise lesson performance trends
  - **Negative marking impact analysis**: Track how negative marking affects student scores

#### 6.5.2 Analytics Dashboard Components
- Lesson performance heatmap\n- Student accuracy by lesson chart
- Question difficulty distribution by lesson
- Lesson completion rates
- Comparative analysis across classes and subjects
- **Negative marking statistics**: Average minus marks applied, questions with highest negative marking impact

### 6.6 Database Migration Script

#### 6.6.1 Migration Steps
1. **Create Lessons Table** (if not existing):
```sql
CREATE TABLE IF NOT EXISTS lessons (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  subject_id UUID NOT NULL REFERENCES subjects(id) ON DELETE CASCADE,
  lesson_name TEXT NOT NULL,
  lesson_code VARCHAR(50),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```\n
2. **Alter Question Bank Table**:
```sql
ALTER TABLE question_bank\nADD COLUMN IF NOT EXISTS bank_name VARCHAR(100),
ADD COLUMN IF NOT EXISTS lesson_id UUID REFERENCES lessons(id) ON DELETE CASCADE,
ADD COLUMN IF NOT EXISTS question_images JSONB,
ADD COLUMN IF NOT EXISTS minus_mark DECIMAL(5,2) DEFAULT 0;\n```

3. **Update question_type Enum** (if using PostgreSQL enum type):
```sql
ALTER TYPE question_type_enum ADD VALUE IF NOT EXISTS 'Match the Following';
ALTER TYPE question_type_enum ADD VALUE IF NOT EXISTS 'Multiple Response MCQ';
```

4. **Create Index for Performance**:
```sql
CREATE INDEX IF NOT EXISTS idx_lessons_subject_id ON lessons(subject_id);
CREATE INDEX IF NOT EXISTS idx_question_bank_lesson_id ON question_bank(lesson_id);
CREATE INDEX IF NOT EXISTS idx_question_bank_bank_name ON question_bank(bank_name);\nCREATE INDEX IF NOT EXISTS idx_question_bank_images ON question_bank USING GIN (question_images);
CREATE INDEX IF NOT EXISTS idx_question_bank_minus_mark ON question_bank(minus_mark);
```\n
5. **Add Foreign Key Constraint**:
```sql
ALTER TABLE question_bank\nADD CONSTRAINT fk_question_bank_lesson\nFOREIGN KEY (lesson_id) REFERENCES lessons(id) ON DELETE CASCADE;
```

6. **Backfill bank_name for Existing Records** (if applicable):
```sql
UPDATE question_bank
SET bank_name = CONCAT(classes.class_name, '_', subjects.subject_name)\nFROM classes, subjects
WHERE question_bank.class_id = classes.id\nAND question_bank.subject_id = subjects.id\nAND question_bank.bank_name IS NULL;
```\n
7. **Set Default Minus Mark for Existing Records**:
```sql
UPDATE question_bank
SET minus_mark = 0\nWHERE minus_mark IS NULL;
```\n
#### 6.6.2 Migration Validation
- Verify lessons table creation
- Verify foreign key constraints are intact
- Verify indexes are created
- Test cascading delete behavior
- Validate bank_name auto-generation logic
- Verify new question types (Match the Following, Multiple Response MCQ) are added to question_type enum
- **Verify question_images column is created with JSONB type**
- **Verify minus_mark column is created with DECIMAL(5,2) type and default value 0**
- **Test minus_mark validation and storage**

## 7. Question Paper Preparation Module

### 7.1 Question Paper Preparation Overview
- **Purpose**: Enable teachers to create question papers from their own question bank
- **Access**: Available only to Teacher role
- **Data Isolation**: Teachers can only access their own question banks and questions
- **Workflow**: Basic Details → Question Selection → Shuffle Options → Preview/Save/Generate
\n### 7.2 Question Paper Preparation Workflow

#### 7.2.1 Step 1: Basic Details (First Step)
- **Class Selection** (Dropdown, required)
  - Populated from classes assigned to logged-in teacher
  - Selection triggers Subject dropdown population
- **Subject Selection** (Dropdown, required)
  - Populated from subjects assigned to logged-in teacher for selected class
  - Selection enables next step
- **Next Button**: Enabled only after both Class and Subject are selected
- **Validation**: System validates that teacher has questions in selected Class-Subject combination before proceeding

#### 7.2.2 Step 2: Question Selection Source
\n**View Options**:
- **View All Questions**: Display all questions from logged-in teacher's question bank for selected Class and Subject
- **View Questions by Question Bank Name**: Filter questions by specific question bank name
\n**Question Bank Name Dropdown**:
- **Data Source**: Populated from question_bank table filtered by:\n  - created_by = logged-in teacher's user ID
  - class_id = selected Class\n  - subject_id = selected Subject
- **Display Format**: Show unique bank_name values (e.g., 'Class10_English', 'Class6_Mathematics')
- **Access Control**: Only question bank names belonging to logged-in teacher are visible
- **Other Teachers' Data**: Question banks created by other teachers must not be visible

#### 7.2.3 Question List Display (Row View)

**Display Format**: Questions displayed in row/table format for easy selection

**Table Columns**:
- **Select** (Checkbox)
  - Multi-select checkboxes for each question
  - Select All checkbox in header row
- **Question Name** (Text)
  - Display question_text (truncated to 100 characters with ellipsis)
  - Click to expand full question in preview modal
- **Difficulty** (Badge)
  - Color-coded badges: Easy (Green), Medium (Yellow), Hard (Red)
\n**Table Features**:
- Compact row layout for efficient scanning
- Hover effect on rows
- Selected rows highlighted with light blue background
- Checkbox state persists during session
- **Only Question Name and Difficulty columns are visible** (no other metadata displayed)

**Question Preview (Optional)**:
- Click on question row to open preview modal
- Preview displays:
  - Full question text
  - Question images (if present)
  - Question type\n  - Options (for MCQ, True/False, Match the Following, Multiple Response MCQ)
  - Correct answer
  - Marks and Minus Mark
  - Difficulty level
- Close button to return to question list

**Selection Actions**:
- **Select All**: Checkbox in header row to select all questions in current view
- **Deselect All**: Uncheck Select All to deselect all questions
- **Individual Selection**: Click checkbox on each row to select/deselect specific questions
- **Selected Count Display**: Show count of selected questions (e.g., '15 questions selected')

#### 7.2.4 Step 3: Shuffle Functionality

**Shuffle Options**:
- **Shuffle Questions** (Checkbox)
  - Label: 'Shuffle Questions'
  - Description: 'Randomize the order of questions in the question paper'
  - Default: Unchecked
  - Action: When checked, questions will be displayed in random order in final paper
- **Shuffle MCQ Options** (Checkbox)
  - Label: 'Shuffle MCQ Options'
  - Description: 'Randomize the order of options inside Multiple Choice questions'
  - Default: Unchecked
  - Action: When checked, options (A, B, C, D) will be randomized for each MCQ question
  - **Applies to**: Multiple Choice, True/False, and Multiple Response MCQ question types
  - **Does not apply to**: Match the Following (left-right pairing must remain intact)
\n**Shuffle Rules**:
- **Data Isolation**: Shuffle applies only to questions selected by logged-in teacher
- **Correct Answer Preservation**: Correct MCQ answers must remain valid after shuffling
  - System automatically updates correct_answer field to reflect new option order
  - For Multiple Response MCQ: All correct answers updated to match new option positions
- **Shuffle Algorithm**: Use secure random number generator for shuffling
- **Shuffle Persistence**: Shuffled order is saved with question paper draft

**Shuffle Implementation Details**:
- **Question Shuffle**:
  - Apply Fisher-Yates shuffle algorithm to selected questions array
  - Maintain question IDs and metadata during shuffle
- **MCQ Option Shuffle**:
  - For each MCQ question, shuffle options array
  - Update correct_answer field to match new option index
  - For Multiple Response MCQ, update all correct answer indices
  - Store original option order for reference (optional)
\n#### 7.2.5 Step 4: Final Question Paper Output

**Preview Question Paper**:
- **Preview Button**: Opens preview modal showing complete question paper
- **Preview Display**:
  - Question paper header:\n    - School name
    - Class and Subject
    - Total marks
    - Total questions
    - Date and time
  - Question list with numbering (1, 2, 3, ...)
  - Each question displays:
    - Question text
    - Question images (if present)
    - Options (for MCQ, True/False, Match the Following, Multiple Response MCQ)\n    - Marks allocation
    - Minus mark (if applicable)
  - Section-wise grouping (optional, based on difficulty or question type)
- **Preview Actions**:
  - Edit button to return to question selection
  - Close button to exit preview\n\n**Save as Draft**:
- **Save Draft Button**: Saves current question paper as draft
- **Draft Data Stored**:
  - Selected questions (question IDs)
  - Shuffle settings (questions shuffled, options shuffled)
  - Class and Subject\n  - Created by (teacher ID)
  - Draft status
  - Created date and time
- **Draft List**: Teachers can view and manage saved drafts
- **Load Draft**: Click on draft to load and continue editing

**Generate Final Question Paper**:
- **Generate Button**: Creates final question paper from selected questions
- **Final Paper Data**:
  - All selected questions with shuffled order (if shuffle enabled)
  - Question paper metadata (class, subject, total marks, date)
  - Teacher information (created by)\n  - Final status (not editable after generation)
- **Final Paper Storage**: Saved in question_papers table
\n**Export as PDF**:
- **Export PDF Button**: Generates PDF file of question paper
- **PDF Layout**:
  - Header: School name, Class, Subject, Date, Total Marks
  - Question list with proper formatting
  - Images embedded in PDF
  - Page numbers and footer
  - Professional layout with clear typography
- **PDF Generation**: Use server-side PDF library (e.g., Puppeteer, jsPDF)
- **Download**: PDF file downloaded to user's device with filename format:'QuestionPaper_Class_Subject_Date.pdf'

**Print Option**:
- **Print Button**: Opens browser print dialog
- **Print Layout**: Optimized for A4 paper size
- **Print Preview**: Shows formatted question paper before printing
- **Print Settings**: Allow user to select printer, page range, copies
\n### 7.3 Question Paper Database Structure

#### 7.3.1 Question Papers Table
**Table name**: question_papers

**Columns**:
- id (UUID, Primary Key)
- school_id (Foreign Key → schools.id)
- class_id (Foreign Key → classes.id)\n- subject_id (Foreign Key → subjects.id)
- paper_name (Varchar, auto-generated)
  - Format: Class_Subject_Date (e.g., 'Class10_English_2025-12-21')
- selected_questions (JSON array)
  - Stores array of question IDs in display order
  - Format: ['question_id_1', 'question_id_2', 'question_id_3', ...]
- shuffle_questions (Boolean, default: false)
- shuffle_mcq_options (Boolean, default: false)
- total_marks (Integer, calculated)\n- total_questions (Integer, calculated)
- status (Enum: Draft, Final)\n- created_by (Foreign Key → users.id)
- created_at (Timestamp)
- updated_at (Timestamp)\n\n#### 7.3.2 Foreign Key Relationships
- school_id → schools.id (CASCADE on delete)
- class_id → classes.id (CASCADE on delete)
- subject_id → subjects.id (CASCADE on delete)
- created_by → users.id (SET NULL on delete)

#### 7.3.3 Indexes
```sql
CREATE INDEX IF NOT EXISTS idx_question_papers_school_id ON question_papers(school_id);
CREATE INDEX IF NOT EXISTS idx_question_papers_class_id ON question_papers(class_id);
CREATE INDEX IF NOT EXISTS idx_question_papers_subject_id ON question_papers(subject_id);
CREATE INDEX IF NOT EXISTS idx_question_papers_created_by ON question_papers(created_by);
CREATE INDEX IF NOT EXISTS idx_question_papers_status ON question_papers(status);\n```

### 7.4 Access Control & Data Isolation

#### 7.4.1 Teacher Access Rules
- **Own Question Banks Only**: Teachers can access only question banks where created_by = logged-in teacher's user ID
- **Own Questions Only**: Teachers can select only questions they created
- **No Visibility of Other Teachers' Data**: Question banks and questions created by other teachers must not be visible
- **School-Based Filtering**: All data filtered by teacher's assigned school

#### 7.4.2 Security Implementation
- **Backend Validation**: Server-side validation to ensure teacher can only access own data
- **SQL Queries**: All queries include WHERE created_by = :teacher_id filter
- **API Endpoints**: Protected with authentication and authorization middleware
- **Error Handling**: Return 403 Forbidden if teacher attempts to access other teachers' data

### 7.5 Question Paper Management Interface

#### 7.5.1 Question Paper List
- **Display**: Table showing all question papers created by logged-in teacher
- **Columns**:
  - Paper Name
  - Class\n  - Subject
  - Total Questions
  - Total Marks
  - Status (Draft/Final)
  - Created Date
  - Actions (View, Edit, Delete, Export PDF, Print)
- **Filter Options**:
  - Filter by Class
  - Filter by Subject\n  - Filter by Status (Draft/Final)
- **Search**: Text search by paper name\n\n#### 7.5.2 Question Paper Actions
- **View**: Open question paper in read-only preview mode
- **Edit**: Available only for Draft status, opens question paper in edit mode
- **Delete**: Delete question paper with confirmation dialog
- **Export PDF**: Generate and download PDF file
- **Print**: Open print dialog with formatted question paper

### 7.6 Enhanced Question Paper Features

#### 7.6.1 Multiple Question Paper Versions
\n**Purpose**: Generate multiple versions of the same question paper simultaneously with different shuffled options to prevent cheating in large classrooms.\n
**Feature Components**:
\n**Version Generation Settings**:
- **Number of Versions** (Dropdown, required)
  - Options: 2, 3, 4, 5 versions
  - Default: 2 versions
  - Label: 'Generate Multiple Versions'
  - Description: 'Create multiple versions (A, B, C, D, E) with different shuffled options'
- **Version Naming Convention**:
  - Version A, Version B, Version C, Version D, Version E
  - Auto-generated based on selected number of versions
- **Shuffle Requirements**:
  - Each version must have different shuffled question order (if Shuffle Questions is enabled)
  - Each version must have different shuffled MCQ options (if Shuffle MCQ Options is enabled)
  - Shuffle algorithm ensures no two versions are identical

**Answer Key Generation**:
- **Auto-generate Answer Keys**: System automatically creates separate answer keys for each version
- **Answer Key Format**:
  - Version identifier (e.g., 'Answer Key - Version A')
  - Question number with correct answer
  - For MCQ: Display correct option letter (A, B, C, D) after shuffling
  - For Multiple Response MCQ: Display all correct option letters
  - For Match the Following: Display correct pairs
  - For Short Answer/Essay: Display model answer text
- **Answer Key Storage**: Stored in separate table or JSON field in question_papers table
- **Answer Key Export**: Export all answer keys as separate PDF files or combined PDF with page breaks

**Version Display & Management**:
- **Version List View**: Display all generated versions in a table
  - Columns: Version Name, Total Questions, Total Marks, Created Date, Actions
  - Actions: Preview, Export PDF, Print, View Answer Key
- **Batch Export**: Export all versions as a single ZIP file containing individual PDFs
- **Batch Print**: Print all versions in sequence with page breaks

**Database Schema Updates**:
```sql
ALTER TABLE question_papers\nADD COLUMN IF NOT EXISTS version_count INTEGER DEFAULT 1,
ADD COLUMN IF NOT EXISTS version_identifier VARCHAR(10),
ADD COLUMN IF NOT EXISTS parent_paper_id UUID REFERENCES question_papers(id) ON DELETE CASCADE,
ADD COLUMN IF NOT EXISTS answer_key JSONB;\n\nCREATE INDEX IF NOT EXISTS idx_question_papers_parent_paper_id ON question_papers(parent_paper_id);\n```

**Implementation Notes**:
- Parent question paper stores version_count and has NULL parent_paper_id
- Child versions reference parent via parent_paper_id
- Each version has unique version_identifier (A, B, C, D, E)
- Answer keys stored in answer_key JSONB column for each version
\n#### 7.6.2 Question Paper Templates

**Purpose**: Save frequently used question paper configurations as reusable templates to streamline future question paper creation.

**Template Components**:

**Template Creation**:
- **Save as Template Button**: Available after question selection and configuration
- **Template Information Fields**:
  - Template Name (required, e.g., 'Mid-term Format', 'Final Exam Format', 'Weekly Quiz Template')
  - Template Description (optional, e.g., 'Standard mid-term exam with40% Easy, 40% Medium, 20% Hard questions')
  - Class (auto-populated from current selection)
  - Subject (auto-populated from current selection)
- **Template Configuration Stored**:
  - Section-wise marks distribution (e.g., Section A: 20marks, Section B: 30 marks)
  - Difficulty ratio (e.g., 40% Easy, 40% Medium, 20% Hard)\n  - Question type distribution (e.g., 10 MCQ, 5 Short Answer, 3 Essay)
  - Shuffle settings (Shuffle Questions: Yes/No, Shuffle MCQ Options: Yes/No)
  - Formatting preferences (header format, footer format, page layout)
  - Total marks target
  - Total questions target
\n**Template Management Interface**:
- **Template List View**: Display all saved templates
  - Columns: Template Name, Class, Subject, Total Marks, Total Questions, Created Date, Actions
  - Actions: Use Template, Edit, Delete, Duplicate
- **Use Template**: Load template configuration into question paper creation workflow
  - Auto-populate shuffle settings\n  - Display target marks and question distribution
  - Suggest questions based on difficulty ratio and question type distribution
- **Edit Template**: Modify template configuration
- **Delete Template**: Remove template with confirmation dialog
- **Duplicate Template**: Create a copy of existing template for modification

**Template Application Workflow**:
1. Teacher clicks 'Use Template' from template list
2. System loads template configuration
3. System displays target marks, question distribution, and difficulty ratio
4. System suggests questions matching template criteria
5. Teacher reviews and selects questions
6. System validates selection against template targets
7. Teacher proceeds to shuffle options and preview
\n**Database Schema for Templates**:
```sql
CREATE TABLE IF NOT EXISTS question_paper_templates (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  template_name VARCHAR(200) NOT NULL,
  template_description TEXT,
  school_id UUID NOT NULL REFERENCES schools.id ON DELETE CASCADE,
  class_id UUID NOT NULL REFERENCES classes.id ON DELETE CASCADE,\n  subject_id UUID NOT NULL REFERENCES subjects.id ON DELETE CASCADE,
  configuration JSONB NOT NULL,
  created_by UUID NOT NULL REFERENCES users.id ON DELETE CASCADE,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);
\nCREATE INDEX IF NOT EXISTS idx_templates_school_id ON question_paper_templates(school_id);\nCREATE INDEX IF NOT EXISTS idx_templates_class_id ON question_paper_templates(class_id);
CREATE INDEX IF NOT EXISTS idx_templates_subject_id ON question_paper_templates(subject_id);\nCREATE INDEX IF NOT EXISTS idx_templates_created_by ON question_paper_templates(created_by);
```

**Configuration JSONB Structure**:
```json
{
  'sections': [
    {'name': 'Section A', 'marks': 20, 'question_types': ['Multiple Choice'], 'difficulty': {'Easy': 60, 'Medium': 30, 'Hard': 10}},
    {'name': 'Section B', 'marks': 30, 'question_types': ['Short Answer', 'Essay'], 'difficulty': {'Easy': 30, 'Medium': 50, 'Hard': 20}}\n  ],
  'total_marks': 50,
  'total_questions': 15,
  'shuffle_questions': true,
  'shuffle_mcq_options': true,
  'formatting': {
    'header_format': 'School Name | Class | Subject | Date',
    'footer_format': 'Page {page} of {total_pages}',
    'page_layout': 'A4'\n  }
}
```
\n#### 7.6.3 Smart Question Selection

**Purpose**: Assist teachers in selecting questions based on intelligent criteria such as difficulty distribution, lesson coverage, and real-time marks calculation.

**Smart Selection Features**:

**Auto-Suggest Questions by Difficulty Distribution**:
- **Difficulty Ratio Input**:
  - Easy: Percentage slider (0-100%)
  - Medium: Percentage slider (0-100%)
  - Hard: Percentage slider (0-100%)
  - Total must equal 100%
  - Default: 40% Easy, 40% Medium, 20% Hard\n- **Target Marks Input**: Number input for total marks (e.g., 50, 100)\n- **Auto-Suggest Button**: Click to generate suggested question list
- **Suggestion Algorithm**:
  - Calculate number of questions needed for each difficulty level based on ratio and target marks
  - Select questions from teacher's question bank matching difficulty criteria
  - Prioritize questions with balanced lesson coverage
  - Display suggested questions with checkboxes pre-selected
- **Suggestion Display**:
  - Show suggested questions in table format
  - Highlight difficulty distribution (e.g., '6 Easy, 6 Medium, 3 Hard')
  - Display total marks of suggested questions
  - Allow teacher to modify selection (add/remove questions)

**Lesson Coverage Indicator**:
- **Purpose**: Ensure balanced topic distribution across lessons
- **Display Components**:
  - Lesson Coverage Chart: Visual chart showing number of questions per lesson
  - Lesson List with Question Count: Table showing lesson name and question count
  - Coverage Percentage: Percentage of lessons covered by selected questions
- **Coverage Alerts**:
  - Warning if any lesson has 0 questions selected
  - Suggestion to add questions from under-represented lessons
  - Highlight lessons with excessive questions
- **Coverage Filters**:
  - Filter questions by lesson to view lesson-specific questions
  - Select all questions from specific lesson with one click
\n**Real-Time Marks Calculation**:
- **Marks Display Panel**: Fixed panel showing real-time calculation
  - Total Marks: Sum of marks from all selected questions
  - Target Marks: User-defined target marks
  - Difference: Target Marks - Total Marks (color-coded: green if match, red if mismatch)
  - Total Questions: Count of selected questions
- **Marks Breakdown by Difficulty**:
  - Easy: Total marks from Easy questions
  - Medium: Total marks from Medium questions
  - Hard: Total marks from Hard questions
- **Marks Breakdown by Question Type**:
  - Multiple Choice: Total marks from MCQ questions
  - Short Answer: Total marks from Short Answer questions
  - Essay: Total marks from Essay questions
- Match the Following: Total marks from Match the Following questions
  - Multiple Response MCQ: Total marks from Multiple Response MCQ questions
- **Visual Indicators**:
  - Progress bar showing percentage of target marks achieved
  - Color-coded alerts (green: target met, yellow: close to target, red: far from target)
\n**Smart Selection UI Components**:
- **Smart Selection Panel**: Collapsible panel at top of question selection page
  - Difficulty Ratio Sliders\n  - Target Marks Input\n  - Auto-Suggest Button
  - Lesson Coverage Chart
  - Real-Time Marks Display
- **Question Table Enhancements**:
  - Lesson column added to question table
  - Marks column added to question table
  - Difficulty badge color-coded
  - Checkbox state synced with smart selection

#### 7.6.4 Preview Enhancements

**Purpose**: Provide comprehensive preview options including side-by-side comparison, print preview, and answer key toggle.

**Enhanced Preview Features**:

**Side-by-Side Preview of Original vs Shuffled Versions**:
- **Split Screen Layout**: Two-column layout showing original and shuffled versions
  - Left Column: Original question order with original MCQ option order
  - Right Column: Shuffled question order with shuffled MCQ option order (if shuffle enabled)
- **Synchronized Scrolling**: Scroll both columns simultaneously for easy comparison
- **Highlight Differences**: Visual indicators showing shuffled questions and options
  - Shuffled questions highlighted with light blue background
  - Shuffled MCQ options highlighted with light yellow background
- **Toggle View**: Switch between side-by-side view and single view
- **Version Selector**: Dropdown to select which version to preview (for multiple versions)
\n**Print Preview with Actual Paper Formatting**:
- **Print Preview Mode**: Opens full-screen preview showing exact paper layout
- **Paper Format Options**:
  - Page Size: A4, Letter, Legal\n  - Orientation: Portrait, Landscape
  - Margins: Normal, Narrow, Wide
- **Preview Display**:
  - Exact page breaks as they will appear in print
  - Header and footer on each page
  - Page numbers
  - Question numbering and formatting
  - Images embedded at correct size
- **Print Preview Actions**:
  - Zoom In/Out: Adjust preview zoom level
  - Page Navigation: Navigate between pages
  - Print Button: Send to printer
  - Close Button: Exit print preview

**Student View vs Answer Key View Toggle**:
- **View Toggle Switch**: Toggle button to switch between Student View and Answer Key View
- **Student View**:
  - Display questions without correct answers
  - Show options for MCQ questions
  - Show blank spaces for Short Answer and Essay questions
  - Hide correct answer indicators
- **Answer Key View**:
  - Display questions with correct answers highlighted
  - For MCQ: Highlight correct option with green background and checkmark icon
  - For Multiple Response MCQ: Highlight all correct options\n  - For Match the Following: Show correct pairs with connecting lines
  - For Short Answer/Essay: Display model answer text
  - Show marks allocation for each question
  - Show minus marks (if applicable)
- **Toggle Persistence**: Remember user's last selected view preference

**Preview UI Enhancements**:
- **Preview Toolbar**: Fixed toolbar at top of preview with action buttons
  - Side-by-Side Toggle
  - Print Preview Button
  - Student/Answer Key Toggle
  - Export PDF Button
  - Close Preview Button
- **Preview Navigation**: Page navigation controls at bottom
  - Previous Page\n  - Page Number Display (e.g., 'Page 1 of 3')
  - Next Page
- Jump to Page (dropdown)
\n#### 7.6.5Bulk Operations

**Purpose**: Enable efficient question selection through bulk operations for faster question paper creation.

**Bulk Operation Features**:
\n**Select All Questions from Specific Lesson**:
- **Lesson Filter Dropdown**: Dropdown showing all lessons in selected subject
- **Select All by Lesson Button**: Button next to each lesson in dropdown
- **Action**: Click button to select all questions from that lesson\n- **Visual Feedback**: Selected questions highlighted in table
- **Deselect Option**: Click again to deselect all questions from that lesson

**Select Questions by Difficulty Level with One Click**:
- **Difficulty Filter Buttons**: Three buttons for Easy, Medium, Hard
- **Select All Easy Button**: Select all Easy questions
- **Select All Medium Button**: Select all Medium questions
- **Select All Hard Button**: Select all Hard questions
- **Combined Selection**: Hold Ctrl/Cmd to select multiple difficulty levels
- **Visual Feedback**: Selected questions highlighted with difficulty badge color

**Batch Shuffle Multiple Question Papers at Once**:
- **Batch Shuffle Interface**: Available in Question Paper Management page
- **Batch Selection**:
  - Checkboxes for each question paper in list
  - Select All checkbox in header
  - Filter by Draft/Final status
- **Batch Shuffle Options**:\n  - Shuffle Questions: Apply to all selected papers
  - Shuffle MCQ Options: Apply to all selected papers\n- **Batch Shuffle Button**: Click to apply shuffle to all selected papers
- **Confirmation Dialog**: Confirm batch shuffle action with summary
  - Number of papers to be shuffled
  - Shuffle settings to be applied
  - Warning: This action cannot be undone for Final papers
- **Batch Processing**:
  - Show progress bar during batch shuffle
  - Display success/error messages for each paper
  - Generate new shuffled versions for each paper

**Bulk Operation UI Components**:
- **Bulk Actions Toolbar**: Fixed toolbar above question table
  - Select All Questions Button
  - Deselect All Questions Button
  - Select by Lesson Dropdown
  - Select by Difficulty Buttons (Easy, Medium, Hard)
  - Selected Count Display (e.g., '15 questions selected')
- **Batch Shuffle Panel**: Panel in Question Paper Management page
  - Batch Selection Checkboxes
  - Shuffle Options Checkboxes
  - Batch Shuffle Button
  - Progress Indicator
\n#### 7.6.6 Version History

**Purpose**: Track all generated question papers with timestamps, enable reuse or modification of previously created papers, and compare different versions.

**Version History Features**:

**Track All Generated Question Papers with Timestamps**:
- **Version History Table**: Display all question papers created by teacher
  - Columns:\n    - Paper Name
    - Version (if multiple versions)
    - Class
    - Subject
    - Total Marks
    - Total Questions
    - Status (Draft/Final)
    - Created Date
    - Last Modified Date
    - Actions (View, Edit, Duplicate, Compare, Delete)
- **Timestamp Display**: Show creation and modification timestamps in user's local timezone
- **Version Grouping**: Group multiple versions of same paper together
  - Parent paper displayed with expand/collapse icon
  - Child versions indented under parent
  - Version identifier (A, B, C, D, E) displayed
\n**Reuse or Modify Previously Created Papers**:
- **Duplicate Paper Action**: Create a copy of existing paper for modification
  - Click'Duplicate' button in Actions column
  - System creates new draft with same configuration
  - New paper name: Original Name + ' (Copy)'
  - All questions, shuffle settings, and configuration copied
  - Teacher can modify duplicated paper without affecting original
- **Edit Draft Papers**: Edit existing draft papers
  - Click 'Edit' button for Draft status papers
  - Load paper into question selection workflow
  - Modify questions, shuffle settings, or configuration
  - Save changes to same draft or save as new draft
- **Reuse Template from Paper**: Convert existing paper into template
  - Click 'Save as Template' button in Actions column
  - Extract configuration from paper\n  - Save as reusable template
\n**Compare Different Versions**:\n- **Compare Versions Interface**: Side-by-side comparison of two or more versions
- **Version Selection**:
  - Select two or more versions from version history table
  - Click 'Compare' button to open comparison view
- **Comparison Display**:
  - Split screen layout showing selected versions side-by-side
  - Synchronized scrolling for easy comparison
  - Highlight differences:\n    - Different question order highlighted
    - Different MCQ option order highlighted
    - Different shuffle settings highlighted
  - Comparison Summary:
    - Total Marks comparison
    - Total Questions comparison\n    - Difficulty distribution comparison
    - Question type distribution comparison
- **Comparison Actions**:
  - Export comparison report as PDF
  - Close comparison view
\n**Version History UI Components**:
- **Version History Page**: Dedicated page accessible from Teacher Dashboard
  - Navigation Menu Item: 'Question Paper History'
  - Version History Table with filters and search
  - Comparison Interface
- **Filters and Search**:
  - Filter by Class
  - Filter by Subject\n  - Filter by Status (Draft/Final/All)
  - Filter by Date Range (Created Date, Last Modified Date)
  - Text search by paper name
- **Sorting Options**:
  - Sort by Created Date (ascending/descending)
  - Sort by Last Modified Date (ascending/descending)
  - Sort by Paper Name (A-Z, Z-A)
  - Sort by Total Marks (ascending/descending)
\n**Database Schema for Version History**:
```sql
ALTER TABLE question_papers\nADD COLUMN IF NOT EXISTS last_modified_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
ADD COLUMN IF NOT EXISTS modification_history JSONB;\n\nCREATE INDEX IF NOT EXISTS idx_question_papers_last_modified_at ON question_papers(last_modified_at);\n```

**Modification History JSONB Structure**:
```json
[\n  {
    'modified_at': '2025-12-21T10:30:00Z',
    'modified_by': 'teacher_user_id',
    'changes': 'Added 3 questions, removed 2 questions',
    'version': 'Draft'\n  },
  {\n    'modified_at': '2025-12-21T11:00:00Z',
    'modified_by': 'teacher_user_id',
    'changes': 'Enabled shuffle questions',
    'version': 'Draft'
  },
  {
    'modified_at': '2025-12-21T11:30:00Z',\n    'modified_by': 'teacher_user_id',\n    'changes': 'Generated final paper',
    'version': 'Final'
  }\n]
```

#### 7.6.7 Save Shuffled Question Paper with Custom Name

**Purpose**: Enable teachers to save shuffled question papers with custom names in Question Paper Management interface, allowing better organization and identification of different shuffled versions.

**Feature Components**:

**Save Shuffled Paper with Custom Name**:
- **Save As Button**: New button available in Question Paper Management interface
  - Location: Actions column in Question Paper List table
  - Label: 'Save As' or 'Save with New Name'
  - Icon: Save icon with plus symbol or duplicate icon
  - Availability: Enabled for both Draft and Final status papers
- **Save As Dialog**:
  - **Dialog Title**: 'Save Question Paper with New Name'
  - **Input Fields**:
    - **New Paper Name** (Text input, required)
      - Placeholder: 'Enter new paper name (e.g., Class10_English_Version2, Mid-term_Shuffled)'
      - Validation: Must be unique within teacher's question papers
      - Character limit: 200 characters
      - Auto-suggest format: Original_Name + '_Shuffled' or Original_Name + '_Version2'
    - **Description** (Text area, optional)
      - Placeholder: 'Add description or notes about this version (optional)'
      - Character limit: 500 characters
  - **Shuffle Options** (Checkboxes, optional):
    - **Re-shuffle Questions**: Apply new shuffle to question order
    - **Re-shuffle MCQ Options**: Apply new shuffle to MCQ options
    - Help text: 'Check to apply new shuffle settings before saving'
  - **Action Buttons**:
    - **Save Button**: Save paper with new name and optional new shuffle\n    - **Cancel Button**: Close dialog without saving
\n**Save As Workflow**:
1. Teacher clicks 'Save As' button in Actions column for any question paper
2. System opens 'Save As' dialog with input fields
3. System auto-populates 'New Paper Name' field with suggested name (Original_Name + '_Shuffled')
4. Teacher can modify the suggested name or enter custom name
5. Teacher optionally adds description\n6. Teacher optionally checks re-shuffle options to apply new shuffle
7. Teacher clicks 'Save' button\n8. System validates new paper name for uniqueness
9. System creates new question paper record with:\n   - New paper name
   - Same selected questions as original paper
   - Same class, subject, and metadata
   - New shuffle applied if re-shuffle options checked
   - Status: Draft (default) or Final (based on user selection)
   - New created_at timestamp
   - Same created_by (teacher ID)
10. System displays success message: 'Question paper saved successfully with name: [New Paper Name]'
11. System refreshes Question Paper List to show new paper

**Database Implementation**:
- **No schema changes required**: Use existing question_papers table
- **New Record Creation**: Create new row with unique ID and new paper_name
- **Data Duplication**: Copy selected_questions, shuffle settings, and metadata from original paper
- **Relationship**: No parent-child relationship needed (independent paper)\n
**UI Components**:
- **Save As Button in Actions Column**:\n  - Icon: Duplicate icon or save-as icon
  - Tooltip: 'Save with new name'
  - Position: Next to Edit, Delete, Export PDF, Print buttons
- **Save As Dialog**:
  - Modal dialog with centered layout
  - Input fields with clear labels and placeholders
  - Validation error messages displayed inline
  - Action buttons at bottom (Save, Cancel)
- **Success Notification**:
  - Toast notification or alert message
  - Display new paper name\n  - Auto-dismiss after 5 seconds
\n**Validation Rules**:
- **New Paper Name**:
  - Required field
  - Must be unique within teacher's question papers
  - Cannot be empty or whitespace only
  - Maximum 200 characters
  - Display error message if name already exists: 'A question paper with this name already exists. Please choose a different name.'
- **Description**:
  - Optional field\n  - Maximum 500 characters
\n**Use Cases**:
1. **Create Multiple Shuffled Versions**: Teacher creates original paper, then uses'Save As' multiple times with re-shuffle enabled to create different shuffled versions (Version1, Version2, Version3)\n2. **Backup Before Editing**: Teacher saves current paper with new name before making major edits to original
3. **Create Variations**: Teacher creates base paper, then uses 'Save As' to create variations for different sections or classes
4. **Archive Old Versions**: Teacher saves current paper with date suffix before updating for new academic year

**Benefits**:
- **Better Organization**: Teachers can maintain multiple versions of same paper with descriptive names
- **Easy Identification**: Custom names help identify purpose or version of each paper
- **Flexible Workflow**: Teachers can create variations without affecting original paper
- **Version Control**: Teachers can track different versions with meaningful names
\n## 8. Teacher Dashboard and Functions

### 8.1 Teacher Login - Dashboard Overview
After Teacher login, the dashboard displays:
- **Assigned Classes**: List of classes assigned to the teacher
- **Assigned Sections**: List of sections assigned to the teacher
- **Assigned Subjects**: List of subjects assigned to the teacher
- **Students of Assigned Sections**: List of students in the assigned sections only
- **Question Bank**: Access to create questions for assigned subjects and lessons with dual view options, image upload capability, and minus mark field
- **Question Paper Preparation**: Access to create question papers from own question bank\n\n### 8.2 Teacher Functions

#### 8.2.1 View Assigned Classes, Sections, and Subjects
- Teacher can view all their assigned classes, sections, and subjects\n- Dashboard displays summary cards with counts
- Detailed view with class-section-subject combinations
\n#### 8.2.2 View Students of Assigned Sections Only
- Teacher can only view students who are in their assigned sections
- Student list displays:\n  - Student Name
  - Class and Section
  - Roll Number
  - Contact Number
- Filter and search options by class, section, or name
- **Visibility Rule**: Teacher cannot view students from other sections or other teachers\n
#### 8.2.3 Question Bank Access
- Teacher can create questions for their assigned subjects and lessons
- Question creation form follows same field order as Principal (Class → Subject → Lesson → Question → Insert Images/Clip Arts → Question Type → Marks → **Minus Mark** → Difficulty → Options → Correct Answer)
- **Image Upload**: Teachers can insert images/clip arts in questions using local file browser, drag-drop, or URL input
- **Minus Mark Field**: Teachers can specify negative marking for questions
- **Dual View Options**:
  - Row View (table format with Minus Mark column)
  - Card View (detailed card format with Minus Mark display)
- Teacher can view and edit questions they created in both views
- Questions are automatically filtered by teacher's assigned subjects\n- Edit functionality available in both Row View and Card View (including image editing with local file selection and minus_mark editing)
- **Support for all question types**: Multiple Choice, True/False, Short Answer, Essay, Match the Following, Multiple Response MCQ\n
#### 8.2.4 Question Paper Preparation\n- **Access**: Available from Teacher Dashboard or Navigation Menu
- **Create New Question Paper**: Click'Create Question Paper' button to start workflow
- **Step1: Basic Details**:
  - Select Class (dropdown)
  - Select Subject (dropdown)
  - Next button enabled after both selections
- **Step 2: Question Selection**:
  - View All Questions or View by Question Bank Name
  - Select questions using checkboxes in row view
  - Preview questions by clicking on rows
  - **Smart Selection**: Use auto-suggest by difficulty distribution, lesson coverage indicator, and real-time marks calculation
  - **Bulk Operations**: Select all questions from specific lesson, select by difficulty level, batch shuffle\n- **Step 3: Shuffle Options**:
  - Enable/disable Shuffle Questions
  - Enable/disable Shuffle MCQ Options
  - **Multiple Versions**: Select number of versions to generate (2-5)
- **Step 4: Output**:
  - **Enhanced Preview**: Side-by-side preview, print preview, student/answer key toggle
  - Save as Draft\n  - **Save as Template**: Save configuration as reusable template
  - Generate Final Question Paper
  - Export as PDF
  - Print\n- **Manage Question Papers**:
  - View list of created question papers with version history
  - Edit drafts
  - Duplicate papers
  - **Save As with Custom Name**: Save shuffled papers with custom names for better organization
  - Compare versions
  - Delete question papers
  - Export and print final papers

#### 8.2.5 Profile Settings
- Teacher can edit their own profile information
- View school details (read-only)
\n## 9. Student Dashboard and Functions\n
### 9.1 Student Login - Dashboard Overview
After Student login, the dashboard displays:
- **My Class**: Student's assigned class\n- **My Section**: Student's assigned section
- **My Subjects**: List of subjects for the student's class
- **My Teachers**: List of teachers assigned to the student's class and section
\n### 9.2 Student Functions

#### 9.2.1 View My Class and Section
- Student can view their assigned class and section
- Display class and section name prominently on dashboard
\n#### 9.2.2 View My Subjects
- Student can view all subjects for their class
- Subject list displays:
  - Subject Name
  - Subject Code
  - Subject Type (Core/Elective/Optional)
\n#### 9.2.3 View My Teachers
- Student can view all teachers assigned to their class and section
- Teacher list displays:\n  - Teacher Name
  - Subject\n  - Contact Information (if available)
\n#### 9.2.4 Profile Settings
- Student can edit their own profile information
- View school details (read-only)
\n## 10. Key Features\n
### 10.1 User Registration and Approval Workflow
- When a new user creates an account (signup), they will be assigned 'Pending Approval' status
- **School Name Field**: During registration, user must select school from dropdown list (populated from School Master created by Admin)
- New users with'Pending Approval' status will be displayed separately in'Pending Users' list (not in Active Users list)
- Admin must review and approve new user accounts\n- Only after Admin approval, user status changes to 'Active' and they are moved to Active Users list
- This prevents unauthorized users from accessing the system
- **Pending Users Display Enhancement**: In the Pending Users section, the School Name column must display the actual school name that the user selected during registration (not a dash or empty value)

### 10.2 Password Reset/Recovery Feature
- **Forgot Password Link**: Available on login page for all users
- **Password Reset Process**:
  - User clicks 'Forgot Password' link on login page
  - System prompts user to enter registered email address
  - System sends password reset link to the registered email
  - Reset link expires after 24 hours for security
  - User clicks the link and is redirected to password reset page
  - User enters new password (with confirmation field)
  - Password requirements: minimum 8 characters, at least one uppercase, one lowercase, one number\n  - System validates and updates the password
  - User receives confirmation email about password change
  - User can now login with new password
- **Security Features**:
  - Reset link is single-use only
  - Link expires after 24 hours
  - Email verification required\n  - Password strength validation
  - Notification email sent after successful password change

### 10.3 Admin Functions
- Create and manage schools in School Master
- Create user accounts for all roles\n- Assign school to each user during account creation (via dropdown)
- Link Principal to school during school creation/editing
- Review and approve pending user registrations
- Role-based Access Control management
- System Settings control\n- **Enhanced User Management Interface**:
  - View and manage users with status-based button navigation at top of page
  - Three clickable status buttons displayed prominently:\n    - **Pending: [count]** (Orange button) - Click to view pending users awaiting approval, with Approve action available
    - **Active: [count]** (Green button) - Click to view active approved users, with Edit and Suspend actions available
    - **Suspended: [count]** (Red button) - Click to view suspended user accounts, with Edit action available
  - Clicking each button filters and displays corresponding user list below
  - Each button shows real-time count of users in that status
  - **Button Actions**: Each status button includes relevant action buttons (Approve for Pending, Edit and Suspend for Active, Edit for Suspended)
  - **Enhanced Search and Filter for Active Users**:
    - Text search bar for searching by username, full name, or email
    - Additional dropdown filters:\n      - Role filter (dropdown with options: All, Admin, Principal, Teacher, Student)
      - School Name filter (dropdown populated from School Master list, with 'All Schools' option)
    - Combined search capability (text search + role filter + school name filter)
    - Real-time filtering as user types or selects filter options
    - Clear filters button to reset all search and filter criteria
    - Filter options displayed prominently above the Active Users table
    - **Filtered Records Count Display**: Display the count of filtered records prominently above the Active Users table (e.g., 'Showing 5 of 20 users' or 'Filtered Results: 5')
- Edit user profiles with Save button
- Suspend user accounts with Suspend button
- Approve pending users with Approve button
- **Cross-school access**: Admin can view and manage all schools and users
- **Full management rights**: Create, edit, suspend, delete\n\n### 10.4 Principal Functions
- **Academic Management**:
  - Class creation\n  - Section creation
  - Subject creation (class-wise)
  - Lesson creation (subject-wise)
  - Student class-section mapping
- **Teacher Management**:
  - View teacher accounts
  - Edit teacher profiles (via Edit button or pencil icon)
  - Teacher-subject-class-section mapping
  - View class-section overview with assigned teachers per subject
- **Student Management**:\n  - View students list with enhanced search (text search + Class and Section filters)
  - View student class-section assignments
- **Question Bank Management**:
  - Create questions with lesson-level tracking and minus mark field
  - Insert images/clip arts in questions using local file browser, drag-drop, or URL input\n  - View and edit all questions in the school
  - Switch between Row View (with Minus Mark column) and Card View (with Minus Mark display)
  - Edit questions in both views (including image editing with local file selection and minus_mark editing)
  - Access analytics dashboard\n  - **Support for all question types**: Multiple Choice, True/False, Short Answer, Essay, Match the Following, Multiple Response MCQ
- Edit own profile with Save button
- View school details (read-only)
- **School-based access**: All data and user lists filtered by assigned school
- **Visibility**: Can view teachers and students from assigned school only

### 10.5 Teacher Functions
- View assigned classes, sections, and subjects
- View students of assigned sections only
- **Question Bank Access**:
  - Create questions for assigned subjects and lessons with minus mark field
  - Insert images/clip arts in questions using local file browser, drag-drop, or URL input
  - View and edit own questions
  - Switch between Row View (with Minus Mark column) and Card View (with Minus Mark display)
  - Edit questions in both views (including image editing with local file selection and minus_mark editing)\n  - **Support for all question types**: Multiple Choice, True/False, Short Answer, Essay, Match the Following, Multiple Response MCQ
- **Question Paper Preparation**:
  - Create question papers from own question bank
  - Select questions by class and subject
  - View questions in row format with Question Name and Difficulty columns
  - **Smart Selection**: Auto-suggest by difficulty distribution, lesson coverage, real-time marks calculation
  - **Bulk Operations**: Select by lesson, select by difficulty, batch shuffle
  - Shuffle questions and MCQ options
  - **Multiple Versions**: Generate 2-5 versions with auto-generated answer keys
  - **Enhanced Preview**: Side-by-side preview, print preview, student/answer key toggle
  - Preview, save as draft, generate final paper
  - **Save as Template**: Save configuration as reusable template
  - **Save As with Custom Name**: Save shuffled papers with custom names for better organization
  - Export as PDF and print
  - Manage question papers (view, edit drafts, duplicate, save as with custom name, compare versions, delete, export, print)
  - **Version History**: Track all generated papers, reuse or modify previous papers, compare versions
- Edit own profile with Save button
- View school details (read-only)\n- **School-based access**: All data and user lists filtered by assigned school
- **Visibility**: Can view students from assigned sections only (cannot view Principal or other teachers)

### 10.6 Student Functions
- View my class, section, subjects, and teachers
- View school name, address, and code in profile
- Edit own profile with Save button
- **School-based access**: Only see personal information from assigned school
- **Visibility**: Can only view their own profile details (cannot view other students, teachers, or Principal)

### 10.7 User Profile Management
- Edit button: Available for all users to modify their profile information (displayed as button or pencil icon)
- Save button: Saves changes made to profile information
- Approve button: Available only for Admin role to approve pending user registrations (integrated into Pending status button)
- Suspend button: Available only for Admin role to suspend user accounts (integrated into Active status button)
- User status categories:
  - Pending Approval: New users awaiting admin approval, cannot login
  - Active: Approved users with full system access
  - Suspended: Users whose accounts have been suspended, cannot login
- **Status-based button navigation**: Admin views display three status buttons (Pending, Active, Suspended) at top of User Management page for quick filtering, with relevant actions integrated into each button
- Admin can filter and manage users based on their status by clicking corresponding button
- **School filtering**: Principal views show only teachers and students from their assigned school; Teacher views show only students from their assigned sections\n\n### 10.8 Principal Dashboard - Total Teachers Card Feature
- **Total Teachers Card**: Displays the total count of teachers in the Principal's assigned school
- **Click Functionality**: When Principal clicks on the'Total Teachers' card, the system opens a 'Teachers Management' page with tabbed interface
- **Data Fetching Rule**: \n  - Fetch all teachers using school_id (not logged-in user ID)
  - Display all teachers registered under the same school
  - Show complete teacher list regardless of which teacher is currently logged in
- **Teachers Management Page - Tab Structure**:
  - **Tab 1: Teachers List**\n    - Display Fields: Teacher Name, Subject, Phone Number\n    - **Edit Action**: Edit button or pencil icon for each teacher row
    - **Enhanced Search and Filter Functionality**:
      - Text search bar for searching by teacher name, phone number, or email
      - Additional dropdown filters:
        - Subject filter (dropdown showing all subjects in the school)
        - Status filter (dropdown with options: All, Active, Pending, Suspended)
      - Combined search capability (text search + subject filter + status filter)
      - Real-time filtering as user types or selects filter options
      - Clear filters button to reset all search and filter criteria
    - Enable sort functionality\n    - Display total count of teachers at the top\n  - **Tab 2: Active Teachers**
    - Display only teachers with 'Active' status
    - Same display fields and functionality as Tab 1
  - **Tab 3: Pending Teachers**
    - Display only teachers with 'Pending Approval' status
    - Same display fields and functionality as Tab 1\n  - **Tab 4: Suspended Teachers**
    - Display only teachers with 'Suspended' status
    - Same display fields and functionality as Tab 1\n  - **Tab 5: Teacher Assignment**
    - **Purpose**: Interface for Principal to assign teachers to subjects, classes, and sections
    - **Display Components**:
      - Teacher selection dropdown (filtered by school)
      - Subject selection dropdown (filtered by school subjects)
      - Class selection dropdown (filtered by school classes)
      - Section multi-select dropdown (filtered by selected class)\n      - 'Assign' button to save the mapping
    - **Current Assignments Table**:
      - Columns: Teacher Name, Subject, Class, Sections (comma-separated), Actions (Edit/Delete)
      - Filter options by teacher, subject, or class
      - Search functionality
      - Sort functionality
    - **Assignment Rules**:
      - One teacher can be assigned to multiple subject-class-section combinations
      - Same teacher can teach different subjects to different classes
      - Multiple teachers can be assigned to same subject in different sections
    - **Edit Assignment**:
      - Click 'Edit' button to modify existing assignment
      - Pre-populate form with current assignment details
      - Save changes with 'Update' button
    - **Delete Assignment**:
      - Click 'Delete' button to remove teacher assignment
      - Confirmation dialog before deletion
- **Access Control**:
  - Only Principal/Headmaster can view and manage this interface
  - Teachers cannot view other teachers or access assignment interface
  - Data is school-wise, not user-wise
- **UX Requirements**:
  - Page header:'Teachers Management - [School Name]'\n  - Tab navigation at the top of the page
  - Active tab highlighted with primary color
  - Responsive design for all screen sizes
  - Loading indicators during data fetch
  - Success/error messages for assignment operations
\n### 10.9 Principal Dashboard - Total Students Card Feature
- **Total Students Card**: Displays the total count of students in the Principal's assigned school
- **Click Functionality**: When Principal clicks on the 'Total Students' card, the system opens a 'Students List' page\n- **Data Fetching Rule**: 
  - Fetch all students using school_id (not logged-in user ID)
  - Display all students registered under the same school
  - Show complete student list regardless of which student is currently logged in
- **Students List Page - Display Fields**:
  - Student Name\n  - Class
  - Phone Number
- **Enhanced Search Functionality**: 
  - Text search bar for searching by name, phone, or email
  - Additional dropdown filters for Class and Section
  - Combined search capability (text search + class filter + section filter)
- **Access Control**:
  - Only Principal/Headmaster can view this list
  - Teachers and Students cannot view this complete list
  - Data is school-wise, not user-wise\n- **UX Requirements**:
  - Page header: 'All Students of This School'
  - Enable search functionality with class and section filters
  - Enable sort functionality
  - Display total count of students at the top of the page
\n### 10.10 Admin Dashboard - Updated Card Display
- **Admin Dashboard Cards**: The Admin Dashboard displays only two cards:
  - **Total Users**: Displays the total count of all users in the system
  - **Total Schools**: Displays the total count of all schools in the system
- **Implementation Notes**:
  - Remove all code related to exam-related metrics from AdminDashboard.tsx
  - Remove API calls for exam data\n  - Remove state variables for exam counts
  - Remove UI components displaying exam-related cards
  - Update dashboard layout to display only two cards in appropriate grid format
\n### 10.11 Landing Page - Updated Design
- **Login and Register Buttons Removed**: The Login and Register buttons previously displayed on the landing page hero section have been removed
- **Get Started Section Removed**: The 'Get Started Today' section with'Create Account' button has been removed from the landing page
- **Simplified Landing Page**: Landing page now focuses on system features and information without direct login/registration prompts
- **Access to Login/Register**: Users can access Login and Register pages through:\n  - Top navigation bar Login/Register links (if present)
  - Direct URL navigation\n  - Alternative entry points as designed
\n## 11. Language Support

### 11.1 UI Language\n- **UI Language: English Only**
- All user interface elements (buttons, menus, labels, navigation, forms, tables, headers, card titles, dashboard elements) will be displayed in English\n- This includes all management interfaces, dashboards, and system pages
- **Strict Enforcement**: No UI text should appear in Tamil or any other language; all interface elements must be in English
\n### 11.2 Chat/Communication Language
- Users can communicate in any language they prefer for chat, messages, or communication features
- Chat language is flexible and not restricted to English
\n### 11.3 Language Rule Summary
- **UI = Always English**
- **Chat/Communication = Any Language**
\n## 12. Future Scope Features

### 12.1 Audit Logs
- User activity logging\n- Track who did what and when
- School-based activity filtering
\n### 12.2 Backup & Restore
- School data backup
- User data backup (school-wise)
- Restore functionality

### 12.3 Notifications
- New user registration notifications for Admin
- School-related updates
- Password reset confirmation notifications

### 12.4 Analytics Dashboard
- User activity analysis (school-wise)
- Teacher-student mapping analysis (school-wise)
- School-wise statistics comparison (Admin only)
- Board/Affiliation-wise comparison (Admin only)
- **Lesson-Level Performance Analytics**:
  - Lesson-wise accuracy of students
  - Lesson-wise difficulty analysis
  - Question distribution by lesson (including Match the Following and Multiple Response MCQ)
  - Student performance comparison across lessons
  - Class-wise lesson performance trends
  - **Negative marking impact analysis**: Track how negative marking affects student scores
  - **Minus mark statistics**: Average minus marks applied, questions with highest negative marking impact

## 13. Design Style\n
### 13.1 Color Scheme
- Primary color: Blue (#2563EB) - conveys trust and educational appearance
- Secondary color: Green (#10B981) - for success and positive actions
- Warning color: Red (#EF4444) - for errors and warnings
- Pending status color: Orange (#F59E0B) - for pending approval indication
- Match the Following badge color: Teal (#14B8A6)\n- Multiple Response MCQ badge color: Indigo (#6366F1)
- **Minus Mark color: Red (#EF4444) or Orange (#F59E0B)** - to indicate negative marking

### 13.2 Visual Details
- Soft rounded corners (8px radius) - modern and friendly appearance
- Subtle shadow effects - depth and hierarchy perception
- Clear borders - for content sections\n\n### 13.3 Overall Layout
- Side panel navigation - fixed left sidebar (240px width) with collapsible toggle button
- **Admin Navigation Menu Items:**
  - Dashboard (with grid icon)
  - User Management (with users icon)
  - School Management (with building icon)
  - System Settings (with gear icon)
- **Principal Navigation Menu Items:**
  - Dashboard\n  - Academic (school-filtered) - with sub-menu: Class Creation, Section Creation, Subject Creation, Lesson Creation, Student Mapping
  - Teachers (school-filtered) - with sub-menu: Teacher Accounts, Teacher-Subject-Class-Section Mapping, Class-Section Overview
  - Students (school-filtered)\n  - Question Bank (school-filtered)
  - Profile Settings\n- **Teacher Navigation Menu Items:**
  - Dashboard
  - Assigned Classes\n  - Assigned Sections\n  - Assigned Subjects\n  - Students (section-filtered)
  - Question Bank (subject-filtered)
  - **Question Paper Preparation** (new menu item)
  - **Question Paper Templates** (new menu item)
  - **Question Paper History** (new menu item)
  - Profile Settings
- **Student Navigation Menu Items:**
  - Dashboard\n  - My Class
  - My Section
  - My Subjects
  - My Teachers\n  - Profile Settings
- Card-based design - for information grouping in main content area
- Responsive grid layout - for various screen sizes
- Main content area adjusts dynamically based on side panel state (collapsed/expanded)
- **Admin User Management Interface**: Status-based button navigation at top of page showing three clickable buttons (Pending: [count], Active: [count], Suspended: [count]) with integrated action buttons (Approve for Pending, Edit and Suspend for Active, Edit for Suspended), plus search and filter options (text search + Role filter + School Name filter) for Active Users section, with filtered records count displayed prominently above the Active Users table
- School management interface with create, edit, and view options\n- Password reset page with clean form layout and clear instructions
- **School-based filtering indicators**: Visual badges or labels showing current school context for non-Admin users
- **Principal Dashboard Cards**: Four main clickable cards (Academic Management, Teachers, Students, Question Bank) that open respective management interfaces, all displayed in English\n- **Academic Management Interface**: Step-by-step workflow for Class Creation → Section Creation → Subject Creation → Lesson Creation → Student Mapping\n- **Teacher-Subject-Class-Section Mapping Interface**: Interactive mapping interface with dropdown selections and visual confirmation\n- **Teachers Management Page**: Tabbed interface with five tabs (Teachers List, Active Teachers, Pending Teachers, Suspended Teachers, Teacher Assignment), with Edit button or pencil icon for each teacher row, plus enhanced search and filter options (text search + Subject filter + Status filter) in Teachers List tab\n- **Teacher Assignment Tab**: Form-based interface with dropdowns for teacher, subject, class, and section selection, plus table showing current assignments\n- **Admin Dashboard Layout**: Two-card grid layout displaying Total Users and Total Schools cards only
- **Students List Page**: Enhanced search interface with text search bar and additional Class and Section dropdown filters\n- **Registration Form**: School Name field displayed as dropdown populated from School Master list
- **Landing Page**: Simplified design with Login/Register buttons and Get Started section removed
- **Pending Users Display**: School Name column in Pending Users section displays the actual school name selected during registration
- **Question Bank Interface**: \n  - **View Toggle Control**: Toggle button or tab control at top of page to switch between Row View and Card View
  - **Row View**: Compact table layout with sortable columns (including Minus Mark column) and Edit/Delete actions, with color-coded badges for all question types (including Match the Following - Teal, Multiple Response MCQ - Indigo), plus image indicator icon for questions with images
  - **Card View**: Detailed card layout displaying all question information (including Minus Mark display) with prominent Edit and Delete buttons
    - **Image Display**: Gallery format with thumbnails and captions, click to view full-size\n    - **Minus Mark Display**: Label'Minus Mark:' followed by value in red/orange color, or'No Negative Marking' in gray if zero\n    - **Match the Following Card**: Two-column layout showing left items and right matches with visual lines or highlighting for correct pairs
    - **Multiple Response MCQ Card**: All options listed with multiple correct answers highlighted with checkmark icons and green background
  - Question creation form with cascading dropdowns (Class → Subject → Lesson) and Minus Mark field after Marks field
  - **Image Upload Section**: 'Add Image' button with multiple selection methods:\n    - Click button to open native file browser for selecting files from local drive (C:, D:, external drives, network drives)
    - Drag and drop files from local file explorer into designated upload area
    - Optional URL input field for entering image URLs
    - Multi-file selection support (Ctrl+Click or Shift+Click)
    - Thumbnail preview with caption input and delete option for each image
    - Upload progress indicator for each file
    - Clear error messages for unsupported formats, size limits, or upload failures
  - **Minus Mark Field**: Number input field displayed immediately after Marks field, with label 'Minus Mark (Negative Marking)', placeholder 'Enter negative marks (e.g., 0.25,0.5, 1.0)', validation for decimal values, and help text 'Marks to be deducted for incorrect answer. Leave empty or enter 0 for no negative marking.'
  - Match the Following Options: Two-column input fields (Left Column and Right Column) displayed simultaneously\n  - Multiple Response MCQ Options: Four option fields with checkboxes to mark multiple correct answers, displayed simultaneously
  - Form persistence fix: Class and Subject remain populated after submission\n  - Question list view with lesson-level filtering and minus mark filtering in both views
  - Analytics dashboard with lesson performance metrics and negative marking statistics
- **Question Paper Preparation Interface**:
  - **Step 1: Basic Details**: Form with Class and Subject dropdowns, Next button enabled after both selections
  - **Step 2: Question Selection**: Row view table with Select checkbox, Question Name, and Difficulty columns only
    - **Smart Selection Panel**: Collapsible panel with difficulty ratio sliders, target marks input, auto-suggest button, lesson coverage chart, and real-time marks display
    - **Bulk Actions Toolbar**: Select All, Deselect All, Select by Lesson dropdown, Select by Difficulty buttons, Selected Count Display\n  - **Step 3: Shuffle Options**: Checkboxes for Shuffle Questions and Shuffle MCQ Options, plus Number of Versions dropdown (2-5)
  - **Step 4: Output**: Buttons for Preview, Save as Draft, Save as Template, Generate Final Paper, Export PDF, and Print
    - **Enhanced Preview**: Side-by-side preview, print preview, student/answer key toggle\n  - **Question Paper List**: Table showing all question papers with columns for Paper Name, Version, Class, Subject, Total Questions, Total Marks, Status, Created Date, Last Modified Date, and Actions (View, Edit, Duplicate, **Save As**, Compare, Delete)
  - **Save As Dialog**: Modal dialog with input fields for New Paper Name, Description, and optional re-shuffle options
  - **Question Paper Preview**: Modal displaying formatted question paper with header, questions, and footer
  - **PDF Export**: Generate and download PDF file with professional layout\n  - **Print**: Browser print dialog with optimized A4 layout\n  - **Batch Shuffle Panel**: Panel with batch selection checkboxes, shuffle options, and batch shuffle button
- **Question Paper Templates Interface**:
  - **Template List Page**: Table showing all saved templates with columns for Template Name, Class, Subject, Total Marks, Total Questions, Created Date, and Actions (Use Template, Edit, Delete, Duplicate)
  - **Template Creation Form**: Form with Template Name, Template Description, Configuration fields (sections, marks distribution, difficulty ratio, question type distribution, shuffle settings, formatting preferences)
  - **Use Template Workflow**: Load template configuration into question paper creation workflow with auto-populated settings and suggested questions
- **Question Paper History Interface**:
  - **Version History Page**: Table showing all question papers with version grouping, timestamps, and comparison functionality
  - **Comparison View**: Side-by-side comparison of two or more versions with synchronized scrolling and highlighted differences
  - **Filters and Search**: Filter by Class, Subject, Status, Date Range, and text search by paper name
\n## 14. Reference Images
1. screenshot.png - Admin dashboard interface showing side panel navigation with Dashboard and User Management menu items
2. screenshot.png - User management interface showing status-based button navigation (Pending, Active, Suspended) with annotation indicating action buttons should be integrated into status buttons and search/filter options for Role and School Name, plus filtered records count display requirement
3. screenshot.png - Login page interface with username, password fields and Forgot Password link
4. screenshot.png - School edit form showing school information fields including name, address, contact details, affiliation, class range, and subjects
5. screenshot.png - Principal dashboard showing Tamil text with annotation'need all UNI in english' indicating requirement for English-only UI
6. screenshot.png -'All Students of This School' page with students list and annotation requesting additional search filters for Class and Section
7. 1000478423.jpg - Error message showing 'Could not find a relationship between questions and subjects in the schema cache' on Question Bank page (resolved by adding lesson_id foreign key and proper schema relationships)
8. screenshot.png - Question creation form showing field order and annotation requesting all four options to be displayed simultaneously
9. screenshot.png - Question creation form showing form persistence issue with annotation requesting Class and Subject fields to remain populated after submission
10. screenshot.png - Question creation form showing Image/Clip Art field with annotation requesting feature to select files directly from local drive
11. screenshot.png - Question creation form showing Marks field with annotation requesting Minus Mark field to be added after Marks field
12. screenshot.png - Question Bank Row View showing Marks column with annotation requesting Minus Mark column to be added after Marks column
13. screenshot.png - Question Paper Preparation interface showing Class and Subject selection with annotation indicating requirement for question selection in row view format with Question Name and Difficulty columns only
14. screenshot.png - Question Paper Management interface showing missing Preview button with annotation 'PREVIEW required'\n15. screenshot.png - Question Paper Management interface showing Draft status with annotation 'Not Active'\n16. screenshot.png - Question Paper Preview interface showing inactive Generate Final Paper button with annotation 'Not in action. Please activate this Button'
17. screenshot.png - Question Paper Management interface showing Actions column with annotation requesting 'Save As' feature to save shuffled papers with custom names
18. screenshot.png - Question Paper Management interface showing Draft status papers with annotation requesting ability to save shuffled versions with different names
19. screenshot.png - Question Paper Preview interface with annotation requesting 'Save As' button to save current paper with new name
\n## 15. Design Style\n
### 15.1 Color Scheme
- Primary color: Blue (#2563EB)\n- Secondary color: Green (#10B981)
- Warning color: Red (#EF4444)
- Pending status color: Orange (#F59E0B)
- Match the Following badge color: Teal (#14B8A6)\n- Multiple Response MCQ badge color: Indigo (#6366F1)
- Minus Mark color: Red (#EF4444) or Orange (#F59E0B)

### 15.2 Visual Details
- Soft rounded corners (8px radius)\n- Subtle shadow effects
- Clear borders
\n### 15.3 Overall Layout
- Side panel navigation with collapsible toggle\n- Card-based design\n- Responsive grid layout
- Main content area adjusts dynamically